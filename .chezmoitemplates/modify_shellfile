#!/bin/bash

set -eu

# Create temporary file to store input
tempfile="$(mktemp)"
trap 'rm -f "${tempfile}"' EXIT
cat > "${tempfile}"

# Define block markers
START_BLOCK="# MANAGED BLOCK BY DOTFILE"
END_BLOCK="# END OF MANAGED BLOCK BY DOTFILE"

# Output content before managed block
sed "/${START_BLOCK}/Q" "${tempfile}"

# Insert template content
echo "${START_BLOCK}"
# Using chezmoi to execute the template
chezmoi execute-template '{{ printf "{{ template \"%s\" }}" . }}'
echo "${END_BLOCK}"

# Output content after managed block
sed -n "/${END_BLOCK}/,\$p" "${tempfile}" | sed "1d"
